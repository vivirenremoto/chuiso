<!DOCTYPE html>
<html>

<head>
    <title>chuiso</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
</head>

<body>

    <style>
        * {
            font-family: 'VT323', monospace;
            text-transform: uppercase;

            -webkit-touch-callout: none;
            /* iOS Safari */
            -webkit-user-select: none;
            /* Safari */
            -khtml-user-select: none;
            /* Konqueror HTML */
            -moz-user-select: none;
            /* Old versions of Firefox */
            -ms-user-select: none;
            /* Internet Explorer/Edge */
            user-select: none;
            /* Non-prefixed version, currently
                            supported by Chrome, Edge, Opera and Firefox */
        }

        body {
            touch-action: pan-x pan-y;
            overflow: hidden;
        }

        .floor {
            position: fixed;
            border-bottom: 5px red solid;
        }

        #item,
        #enemy,
        #player {
            margin-top: -3px;
        }
    </style>


    <div id="game" style="position:fixed;left:0;right:0;top:0;bottom:0;">


        <div id="floor1" class="floor"></div>

        <div id="floor2" class="floor"></div>

        <div id="floor3" class="floor"></div>

        <div id="enemy"
            style="z-index:2;border-radius:100px;border:2px black solid;position:fixed;background:#fff url('static/john.png');background-size:contain;width:100px;height:100px;">
        </div>

        <div id="player"
            style="z-index:2;border-radius:100px;border:2px black solid;position:fixed;background:#fff url('static/chuiso.png');background-size:contain;width:100px;height:100px;">
        </div>

        <div id="item"
            style="display:none;border-radius:100px;border:2px black solid;position:fixed;background:#fff url('static/excel.jpg');background-size:contain;width:100px;height:100px;">
        </div>


        <div id="stairs1" style="position:fixed;width:10px;background:orange;"></div>


        <!--display:none;-->
        <div id="door"
            style="display:none;border-radius:100px;border:2px black solid;position:fixed;background:#fff url('static/door_closed.png');background-size:contain;width:100px;height:100px;">


        </div>



        <script>
            var screen_height = $(document).height();
            var screen_width = $(document).width();
            var screen_height_half = (screen_height / 2);
            var screen_width_half = (screen_width / 2);

            var enemy_speed = 10;
            var enemy_x;
            var enemy_y;
            var enemy_width = parseInt($('#enemy').css('width'));
            var enemy_height = parseInt($('#enemy').css('height'));
            var enemy_pos = 'right';

            var player_speed = 10;
            var player_x;
            var player_y;
            var player_x_start;
            var player_y_start;
            var player_width = parseInt($('#player').css('width'));
            var player_height = parseInt($('#player').css('height'));

            var item_x;
            var item_y;
            var item_height = 100;
            var item_width = 100;

            var floor_height = 10;
            var floor_width = screen_width;// parseInt(screen_width / 2);
            var floor_current = 1;
            var floor_min = 1;
            var floor_max = $('.floor').length;

            var timer_finish;

            var door_x;
            var door_y;

            var got_item = false;


            //$('#floor2').css('border-width', floor_height).css('width', floor_width).css('left', ((screen_width - floor_width) / 2)).css('top', ((screen_height / 3) * 2));
            //$('#floor3').css('border-width', floor_height).css('width', floor_width).css('left', ((screen_width - floor_width) / 2)).css('top', ((screen_height / 3) * 1));

            $('#floor2').css('border-width', floor_height).css('width', screen_width).css('left', 0).css('top', ((screen_height / 3) * 2));
            $('#floor3').css('border-width', floor_height).css('width', screen_width).css('left', 0).css('top', ((screen_height / 3) * 1));



            $('#floor1').css('border-width', floor_height).css('width', screen_width).css('left', 0).css('top', screen_height - floor_height);

            $('#item').css('width', item_width).css('height', item_height);

            //$('#stars1').css('width', floor_width).css('left', ((screen_width - floor_width) / 2)).css('top', $('#floor2').css('top'));


            var stairs_x = player_width;// parseInt($('#floor2').css('left'));
            var stairs_y = parseInt($('#floor3').css('top'));
            $('#stairs1').css('left', stairs_x).css('top', stairs_y).css('height', screen_height - (floor_height + parseInt($('#floor3').css('top'))));



            enemy_x = parseInt($('#floor2').css('left'));
            enemy_y = parseInt($('#floor2').css('top')) - enemy_height;
            //            enemy_x_start = enemy_x;
            //            enemy_x_end = enemy_x + (floor_width - enemy_width);

            enemy_x_start = enemy_x;
            enemy_x_end = screen_width - enemy_width;



            item_x = enemy_x_start + parseInt((floor_width - enemy_width) / 2);
            item_y = parseInt($('#floor3').css('top')) - item_height;





            door_x = screen_width - item_width;
            door_y = screen_height - (item_height + floor_height);



            player_x_start = 0;
            player_y_start = screen_height - (floor_height + player_height);



            $('#player').css('left', player_x_start).css('top', player_y_start);

            $('#enemy').css('left', enemy_x).css('top', enemy_y);

            $('#item').css('left', item_x).css('top', item_y);


            $('#door').css('left', door_x).css('top', door_y);




            setTimeout(function () {
                $('#item').fadeIn('slow');
            }, 2000);

            setInterval(function () {
                if (enemy_pos == 'right') {
                    enemy_x += 1;//enemy_speed;
                    if (enemy_x >= enemy_x_end) {
                        enemy_pos = 'left';
                    }
                } else {
                    enemy_x -= 1;//enemy_speed;
                    if (enemy_x <= enemy_x_start) {
                        enemy_pos = 'right';
                    }
                }

                //console.log(enemy_pos);

                $('#enemy').css('left', enemy_x + 'px');

            }, 1);



            timer_finish = setInterval(function () {



                player_x = parseInt($('#player').css('left'));
                player_y = parseInt($('#player').css('top'));


                //door
                if (got_item) {



                    var diff_x = (player_x - door_x);
                    if (diff_x < 0) diff_x *= -1;

                    var diff_y = (player_y - door_y);
                    if (diff_y < 0) diff_y *= -1;




                    if (diff_x < player_width) {
                        if (diff_y < player_height) {



                            clearInterval(timer_finish);


                            $('#enemy').hide();
                            $('#player').hide();
                            $('#door').hide();
                        }
                    }

                    // excel
                } else {
                    var diff_x = (player_x - item_x);
                    if (diff_x < 0) diff_x *= -1;

                    var diff_y = (player_y - item_y);
                    if (diff_y < 0) diff_y *= -1;


                    if (diff_x < player_width) {
                        if (diff_y < player_height) {

                            got_item = true;

                            //clearInterval(timer_finish);
                            $('#item').hide();

                            $('#door').css('background-image', "url('static/door_open.png')").fadeIn('slow');
                        }
                    }
                }

                // enemy
                var diff_x = (player_x - enemy_x);
                if (diff_x < 0) diff_x *= -1;

                var diff_y = (player_y - enemy_y);
                if (diff_y < 0) diff_y *= -1;


                if (diff_x < player_width) {
                    if (diff_y < player_height) {

                        $('#player').css('left', player_x_start).css('top', player_y_start);
                        floor_current = 1;
                        got_item = false;
                        $('#door').hide();
                        $('#item').fadeIn('slow');
                    }
                }











            }, 500);

            function moveLeft() {
                player_x = parseInt($('#player').css('left'));
                player_x -= player_speed;

                var max_left;

                if (floor_current == 1) {
                    max_left = 0;
                } else {
                    max_left = parseInt($('#floor' + floor_current).css('left'));
                }


                if (player_x < max_left) {
                    player_x = max_left;
                }

                $('#player').css('left', player_x);
            }

            function moveRight() {
                player_x = parseInt($('#player').css('left'));
                player_x += player_speed;




                var max_right;



                if (floor_current == 1) {
                    max_right = screen_width - player_width;
                } else {
                    max_right = screen_width - player_width - parseInt($('#floor' + floor_current).css('left'));
                }




                if (player_x >= max_right) {
                    player_x = max_right;
                }

                $('#player').css('left', player_x);
            }


            function updateFloor() {



                $('#player').css('top', parseInt($('#floor' + floor_current).css('top')) - player_height);
            }


            function moveUp() {

                player_x = parseInt($('#player').css('left'));
                player_y = parseInt($('#player').css('top'));


                var diff_x = (player_x - stairs_x);
                if (diff_x < 0) diff_x *= -1;



                if (diff_x < player_width) {




                    floor_current++;
                    if (floor_current >= floor_max) {
                        floor_current = floor_max;
                    }



                    updateFloor();

                    //player_y -= player_speed;
                    //$('#player').css('top', player_y);
                }


            }

            function moveDown() {
                player_x = parseInt($('#player').css('left'));
                player_y = parseInt($('#player').css('top'));


                var diff_x = (player_x - stairs_x);
                if (diff_x < 0) diff_x *= -1;



                if (diff_x < player_width) {


                    floor_current--;


                    if (floor_current < floor_min) {
                        floor_current = floor_min;
                    }

                    updateFloor();

                    //player_y -= player_speed;
                    //$('#player').css('top', player_y);
                }


            }


            $("body").keydown(function (e) {
                if (e.keyCode == 37) {
                    moveLeft();
                } else if (e.keyCode == 39) {
                    moveRight();
                } else if (e.keyCode == 38) {
                    moveUp();
                } else if (e.keyCode == 40) {
                    moveDown();
                }
            });



            var timer_move;
            $("body").on("mousedown touchstart", function (e) {



                timer_move = setInterval(function () {


                    var page_x = e.pageX;
                    if (!page_x) page_x = e.originalEvent.touches[0].pageX;

                    var page_y = e.pageY;
                    if (!page_y) page_y = e.originalEvent.touches[0].pageY;




                    if (page_x < screen_width_half) {
                        moveLeft();
                        console.log('left');
                    } else {
                        moveRight();
                        console.log('right');
                    }



                    if (page_y < screen_height_half) {
                        moveUp();
                        console.log('up');
                    } else {
                        moveDown();
                        console.log('down');
                    }

                }, 50);
            });


            $("body").on("mouseup touchend", function (e) {
                clearInterval(timer_move);
            });




        </script>


</body>

</html>